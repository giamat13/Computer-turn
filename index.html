<!DOCTYPE html>
<html lang="he" dir="rtl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>מערכת חילוק תורות - ניהול זמן מחשב לילדים</title>
    <link href="https://fonts.googleapis.com/css2?family=Varela+Round&family=Alef:wght@400;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="container">
        <h1><img src="https://cdn.supercoloring.com/coloring/2204302/1190-laptop-emoji-coloring-page-original.png" style="width: 50px; height: 50px; vertical-align: middle; margin-left: 10px;"> מערכת חילוק תורות במחשב</h1>

        <div class="tabs">
            <button class="tab active" data-tab="setup">⚙️ הגדרות</button>
            <button class="tab" data-tab="manage">👥 ניהול</button>
            <button class="tab" data-tab="timer">⏱️ טיימר</button>
        </div>

        <!-- Setup Tab -->
        <div class="tab-content active" id="setup">
            <div class="card">
                <h2>הגדרות מערכת</h2>
                
                <div class="form-group">
                    <div class="checkbox-group">
                        <input type="checkbox" id="priorityMode">
                        <label for="priorityMode">עדיפות לילדים שעושים שיעורי בית</label>
                    </div>
                </div>

                <div class="form-group">
                    <label for="defaultTime">זמן ברירת מחדל לכל ילד (דקות):</label>
                    <input type="number" id="defaultTime" value="30" min="1">
                </div>

                <div class="form-group">
                    <div class="checkbox-group">
                        <input type="checkbox" id="allowPause">
                        <label for="allowPause">אפשר השהיה של הטיימר</label>
                    </div>
                </div>

                <div class="form-group">
                    <div class="checkbox-group">
                        <input type="checkbox" id="allowReset">
                        <label for="allowReset">אפשר איפוס של הטיימר</label>
                    </div>
                </div>

                <div class="form-group">
                    <div class="checkbox-group">
                        <input type="checkbox" id="showProgress">
                        <label for="showProgress">הצג קו התקדמות</label>
                    </div>
                </div>

                <div class="form-group">
                    <div class="checkbox-group">
                        <input type="checkbox" id="showPercent">
                        <label for="showPercent">הצג אחוזים</label>
                    </div>
                </div>

                <div class="form-group">
                    <div class="checkbox-group">
                        <input type="checkbox" id="countDown">
                        <label for="countDown">ספירה לאחור (במקום קדימה)</label>
                    </div>
                </div>

                <div class="form-group">
                    <label for="warningTime">התראת אזהרה (דקות לפני סיום):</label>
                    <input type="number" id="warningTime" value="2" min="0" max="10">
                </div>

                <div class="form-group">
                    <label for="themeSelect">ערכת נושא:</label>
                    <select id="themeSelect">
                        <option value="light">בהיר (ברירת מחדל)</option>
                        <option value="dark">כהה</option>
                        <option value="ocean">אוקיינוס</option>
                    </select>
                </div>

                <div style="padding: 15px; background: var(--bg-main); border-radius: 10px; margin-top: 20px;">
                    <p style="color: var(--success); text-align: center; font-weight: bold;">✅ ההגדרות נשמרות אוטומטית</p>
                </div>
            </div>

            <div class="card">
                <h2>📊 סטטיסטיקות</h2>
                <button onclick="app.showStatistics()" class="btn-secondary">📈 הצג סטטיסטיקות מפורטות</button>
                <button onclick="app.resetStatistics()" class="btn-danger" style="margin-right: 10px;">🔄 אפס סטטיסטיקות</button>
                <button onclick="app.exportData()" class="btn-success" style="margin-right: 10px;">💾 ייצא נתונים</button>
            </div>

            <div class="card">
                <h2>⚖️ חוקים ועונשים</h2>
                <p style="color: var(--text-secondary); margin-bottom: 20px;">
                    הגדר חוקים אוטומטיים למה שקורה כשילד נשאר מעבר לזמן או יוצא לפני הזמן
                </p>

                <div id="rulesList"></div>

                <button onclick="app.openCustomRuleModal()" class="btn-secondary" style="margin-top: 15px;">
                    ➕ צור חוק מותאם אישית
                </button>
            </div>
        </div>

        <!-- Manage Tab -->
        <div class="tab-content" id="manage">
            <div class="card">
                <h2>הוספת ילדים</h2>
                
                <div class="form-group">
                    <label for="childName">שם הילד:</label>
                    <input type="text" id="childName" placeholder="הכנס שם">
                </div>

                <div class="form-group">
                    <label for="childTime">זמן מוקצה (דקות):</label>
                    <input type="number" id="childTime" placeholder="ברירת מחדל">
                </div>

                <div class="form-group">
                    <div class="checkbox-group">
                        <input type="checkbox" id="childHomework">
                        <label for="childHomework">יש לו שיעורי בית לעשות</label>
                    </div>
                </div>

                <button onclick="app.addChild()">➕ הוסף ילד</button>
            </div>

            <div class="card">
                <h2>רשימת ילדים</h2>
                <div id="childrenList"></div>
            </div>

            <div class="card">
                <h2>מכשירים</h2>
                
                <div class="form-group">
                    <label for="deviceName">שם המכשיר:</label>
                    <input type="text" id="deviceName" placeholder="מחשב 1, טאבלט, וכו'">
                </div>

                <button onclick="app.addDevice()">➕ הוסף מכשיר</button>
                
                <div id="devicesList" style="margin-top: 20px;"></div>
            </div>
        </div>

        <!-- Timer Tab -->
        <div class="tab-content" id="timer">
            <div class="card">
                <h2>הפעלת תור</h2>
                
                <p style="color: var(--text-secondary); margin-bottom: 20px;">
                    התור יקבע לפי ההגדרות של כל ילד. ילדים עם שיעורי בית יקבלו עדיפות ויקבלו תור רצוף עד שיסיימו.
                </p>

                <div id="activeDevicesInfo" style="display: none; background: var(--bg-main); padding: 15px; border-radius: 10px; margin-bottom: 20px;">
                    <h3 style="color: var(--primary); font-size: 1rem; margin-bottom: 10px;">📱 מכשירים פעילים כרגע:</h3>
                    <div id="activeDevicesList"></div>
                </div>

                <button onclick="app.startQueue()" class="btn-success">🚀 התחל תור</button>
                <button onclick="app.shuffleQueue()" class="btn-warning shuffle-btn">🔀 ערבב סדר</button>
                <button onclick="app.updateActiveDevicesDisplay()" class="btn-secondary" style="margin-right: 10px;">🔄 רענן מכשירים</button>
            </div>

            <div class="timer-display" id="timerDisplay" style="display: none;">
                <h2 id="currentChildName">-</h2>
                <div class="time" id="timeDisplay">00:00</div>
                
                <div class="progress-bar" id="progressContainer" style="display: none;">
                    <div class="progress-fill" id="progressBar">
                        <span id="percentDisplay"></span>
                    </div>
                </div>

                <div class="stats">
                    <div class="stat-card">
                        <div class="value" id="elapsedTime">0:00</div>
                        <div class="label">זמן שעבר</div>
                    </div>
                    <div class="stat-card">
                        <div class="value" id="remainingTime">0:00</div>
                        <div class="label">זמן נותר</div>
                    </div>
                    <div class="stat-card" id="overtimeCard" style="display: none;">
                        <div class="value" id="overtimeValue" style="color: #FF6B6B;">0:00</div>
                        <div class="label">⚠️ OVERTIME</div>
                    </div>
                </div>

                <div class="control-buttons">
                    <button onclick="app.startTimer()" class="btn-success" id="startBtn">▶️ התחל</button>
                    <button onclick="app.pauseTimer()" class="btn-warning" id="pauseBtn" style="display: none;">⏸️ השהה</button>
                    <button onclick="app.resetTimer()" class="btn-danger" id="resetBtn">🔄 איפוס</button>
                    <button onclick="app.nextChild()" class="btn-secondary">⏭️ הבא</button>
                </div>
            </div>

            <div class="card">
                <h2>תור המתנה</h2>
                <div class="queue-list" id="queueList"></div>
            </div>
        </div>
    </div>

    <!-- Custom Rule Modal -->
    <div class="modal" id="customRuleModal">
        <div class="modal-content">
            <span class="close-modal" onclick="app.closeCustomRuleModal()">×</span>
            <h2 style="color: var(--primary); margin-bottom: 20px;">צור חוק מותאם אישית</h2>

            <div class="help-text">
                <strong>💡 איך זה עובד?</strong><br>
                <strong>overtime</strong> = כמה שניות נשאר מעבר לזמן (חיובי) או כמה יצא לפני (שלילי)<br>
                <strong>nextTurn</strong> = זמן התור הבא של הילד בשניות<br>
                <strong>defaultTurn</strong> = זמן ברירת המחדל בשניות<br>
                <strong>allOthers</strong> = משפיע על כל הילדים האחרים בתור
            </div>

            <div class="form-group">
                <label for="ruleName">שם החוק:</label>
                <input type="text" id="ruleName" placeholder="לדוגמה: עונש על איחור">
            </div>

            <div class="form-group">
                <label for="ruleDescription">תיאור החוק:</label>
                <input type="text" id="ruleDescription" placeholder="מה החוק עושה?">
            </div>

            <div class="formula-builder">
                <label>תנאי (מתי החוק חל?):</label>
                <div style="margin: 10px 0;">
                    <button class="variable-btn" onclick="app.insertVariable('ruleCondition', 'overtime')">overtime</button>
                    <button class="variable-btn" onclick="app.insertVariable('ruleCondition', '>')">></button>
                    <button class="variable-btn" onclick="app.insertVariable('ruleCondition', '<')"><</button>
                    <button class="variable-btn" onclick="app.insertVariable('ruleCondition', '>=')">>=</button>
                    <button class="variable-btn" onclick="app.insertVariable('ruleCondition', '<=')"><=</button>
                    <button class="variable-btn" onclick="app.insertVariable('ruleCondition', '(');">(</button>
                    <button class="variable-btn" onclick="app.insertVariable('ruleCondition', ')');">)</button>
                    <button class="variable-btn" onclick="app.insertVariable('ruleCondition', '60')">60 (שניות)</button>
                    <button class="variable-btn" onclick="app.insertVariable('ruleCondition', '300')">300 (5 דק')</button>
                </div>
                <input type="text" id="ruleCondition" placeholder="לדוגמה: overtime > 60" style="font-family: monospace;">
            </div>

            <div class="formula-builder">
                <label>פעולה (מה קורה?):</label>
                <div style="margin: 10px 0;">
                    <button class="variable-btn" onclick="app.insertVariable('ruleAction', 'nextTurn')">nextTurn</button>
                    <button class="variable-btn" onclick="app.insertVariable('ruleAction', 'defaultTurn')">defaultTurn</button>
                    <button class="variable-btn" onclick="app.insertVariable('ruleAction', 'allOthers')">allOthers</button>
                    <button class="variable-btn" onclick="app.insertVariable('ruleAction', 'overtime')">overtime</button>
                    <button class="variable-btn" onclick="app.insertVariable('ruleAction', ' + ')">+</button>
                    <button class="variable-btn" onclick="app.insertVariable('ruleAction', ' - ')">-</button>
                    <button class="variable-btn" onclick="app.insertVariable('ruleAction', ' * ')">*</button>
                    <button class="variable-btn" onclick="app.insertVariable('ruleAction', ' / ')">/</button>
                    <button class="variable-btn" onclick="app.insertVariable('ruleAction', '(');">(</button>
                    <button class="variable-btn" onclick="app.insertVariable('ruleAction', ')');">)</button>
                    <button class="variable-btn" onclick="app.insertVariable('ruleAction', 'Math.abs')">Math.abs</button>
                    <button class="variable-btn" onclick="app.insertVariable('ruleAction', 'Math.floor')">Math.floor</button>
                </div>
                <input type="text" id="ruleAction" placeholder="לדוגמה: nextTurn - overtime - 300" style="font-family: monospace;">
            </div>

            <div style="margin-top: 20px; display: flex; gap: 10px;">
                <button onclick="app.saveCustomRule()" class="btn-success">💾 שמור חוק</button>
                <button onclick="app.closeCustomRuleModal()" class="btn-secondary">ביטול</button>
            </div>
        </div>
    </div>

    <!-- Edit Child Modal -->
    <div class="modal" id="editChildModal">
        <div class="modal-content">
            <span class="close-modal" onclick="app.closeEditChildModal()">×</span>
            <h2 style="color: var(--primary); margin-bottom: 20px;">ערוך ילד</h2>

            <input type="hidden" id="editChildId">

            <div class="form-group">
                <label for="editChildName">שם הילד:</label>
                <input type="text" id="editChildName" placeholder="הכנס שם">
            </div>

            <div class="form-group">
                <label for="editChildTime">זמן מוקצה (דקות):</label>
                <input type="number" id="editChildTime" placeholder="ברירת מחדל">
            </div>

            <div class="form-group">
                <div class="checkbox-group">
                    <input type="checkbox" id="editChildHomework">
                    <label for="editChildHomework">יש לו שיעורי בית לעשות</label>
                </div>
            </div>

            <div style="margin-top: 20px; display: flex; gap: 10px;">
                <button onclick="app.saveEditChild()" class="btn-success">💾 שמור שינויים</button>
                <button onclick="app.closeEditChildModal()" class="btn-secondary">ביטול</button>
            </div>
        </div>
    </div>

    <script src="app.js"></script>
</body>
</html>
